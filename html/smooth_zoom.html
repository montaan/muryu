<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>muryu</title>
    <style type="text/css">
      body {
        margin : 0px;
        padding : 0px;
      }
      #map {
        width: 1024px;
        height: 512px;
        position: absolute;
        top: 0px;
        left: 0px;
        background-color: gray;
      }
      #loadStats {
        margin: 0px;
        padding: 5px;
        width: 250px;
        background-color: black;
        color: white;
      }
      #help {
        margin: 0px;
        padding: 5px;
        width: 500px;
        background-color: #e3e6ec;
        color: black;
      }
      h3 {
        margin-top: 0px;
        margin-bottom: 5px;
      }
      h4 {
        margin-top: 15px;
        margin-bottom: 2px;
      }
      p {
        margin-top: 1px;
        margin-bottom: 4px;
      }
      .tile {
        border: 0px;
      }
    </style>
    <link rel="stylesheet" href="scripts/desk_js/style.css"></link>
    <script type="text/javascript" src="scripts/zogen/TileMap.js"></script>
    <script type="text/javascript" src="scripts/desk_js/prototype.js"></script>
    <script type="text/javascript" src="scripts/desk_js/soundmanager2.js"></script>
    <script type="text/javascript" src="scripts/desk_js/desk.js"></script>
    <script>
      // <![CDATA[
      window.addEventListener("load", function(ev){
        var map = document.getElementById("map")
        Desk.Windows.setContainer(map)
        map.style.width = window.innerWidth + 'px'
        map.style.height = window.innerHeight + 'px'
        setInterval(function(){
          if (window.innerWidth != Desk.Windows.previousInnerWidth ||
              window.innerHeight != Desk.Windows.previousInnerHeight) {
            map.style.width = window.innerWidth + 'px'
            map.style.height = window.innerHeight + 'px'
            Desk.Windows.previousInnerWidth = window.innerWidth
            Desk.Windows.previousInnerHeight = window.innerHeight
          }
        }, 100)
        window.Map = new TileMap(Desk.Windows.windowContainer)
        window.Map.panBy(100, 100)
        window.Map.setWidth(window.innerWidth)
        window.Map.setHeight(window.innerHeight)
        Desk.Windows.addListener('resize', function(v){
          window.Map.setWidth(v.width)
          window.Map.setHeight(v.height)
        })
        var panel = new Desk.Panel('top')
        panel.addApplet(Applets.Session())
        panel.addApplet(Applets.Taskbar())
        var help_window = new Desk.Window($('help'), {title: 'help', x:200, y:10})
        if (true) { // start instrumentation block
          var load_buf = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
          var req_buf = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
          var last_reqs = 0
          var last_loads = 0
          var max_rps = 0
          var max_lps = 0
          var ls = E('pre', null, 'loadStats')
          ls.style.display = 'block'
          new Desk.Window(ls, {title:"stats", x: 750, y: 10})
          var updatesPerSec = 5
          var start_time = new Date().getTime()
          setInterval(function(){
            req_buf.shift()
            load_buf.shift()
            req_buf.push(Map.loader.totalCompletes - last_reqs)
            load_buf.push(Map.loader.totalLoads - last_loads)
            last_reqs = Map.loader.totalCompletes
            last_loads = Map.loader.totalLoads
            var reqs = 0
            var loads = 0
            for (var i=0; i<req_buf.length; i++) reqs += req_buf[i]
            for (var i=0; i<load_buf.length; i++) loads += load_buf[i]
            var rps = updatesPerSec * reqs / req_buf.length
            var lps = updatesPerSec * loads / load_buf.length
            if (rps > max_rps) max_rps = rps
            if (lps > max_lps) max_lps = lps
            var bw = rps * 0.125 + ' Mbps'
            var max_bw = max_rps * 0.125 + ' Mbps'
            var total_bw = Map.loader.totalLoads * 0.125
            var avg_bw = total_bw / ((new Date().getTime() - start_time) * 0.001)
            ls.innerHTML = [
              "         requests: " + Map.loader.totalRequests,
              "          cancels: " + Map.loader.totalCancels,
              "            loads: " + Map.loader.totalLoads,
              "        completed: " + Map.loader.totalCompletes,
              "       load ratio: " + parseInt(100*(Map.loader.totalLoads / Map.loader.totalRequests)) / 100,
              " completion ratio: " + parseInt(100*(Map.loader.totalCompletes / Map.loader.totalLoads)) / 100,
              " pending requests: " + Map.loader.queue.queue.length,
              "        loads/sec: " + lps,
              "    completes/sec: " + rps,
              "    bandwidth use: " + bw,
              "    max loads/sec: " + max_lps,
              "max completes/sec: " + max_rps,
              "    bandwidth max: " + max_bw,
              "average bandwidth: " + parseInt(100*avg_bw) / 100 + 'Mbps',
              "  total bandwidth: " + parseInt(100*total_bw) / 100 + 'Mb',
              "              fps: " + parseInt(100*Map.fps) / 100,
              "      average fps: " + parseInt(100*Map.avgFps) / 100
            ].join("\n")
          }, 1000/updatesPerSec)
        } // end instrumentation block
      }, false)
      // ]]>
    </script>
  </head>
  <body>
    <div id="map"></div>
    <div id="help">
      <h3>Hello there!</h3>
      <p>
        Welcome, welcome! What you're looking at is a zoomable file manager.
        Think zoomable map, but replace cities with directories and buildings
        with files.
      </p>
      <h4>Navigation</h4>
      <p>
        Use the mouse wheel to zoom the camera towards and away from the pointer.
        You can also use the <b>t</b> and <b>g</b> keys to zoom.
        To pan the map, grab and drag the map with the pointer.
      </p>
      <h4>Contacts</h4>
      <p>
        Add new contacts by clicking on the "Contacts"-button
        at the top of the screen. The contacts window also lets you create new groups,
        invite people to your groups and join public groups.
      </p>
      <h4>Uploading</h4>
      <p>
        Upload files and archives from your computer by clicking the
        "Upload"-button at the top of the screen.
        When you discover something good on your browsing escapades,
        use the Muryu Firefox add-on to send it your map with a single click.
      </p>
      <h4>Sharing</h4>
      <p>
        To share your discoveries, select the things you wish to share and
        click on "Share with a group" or "Share with the world." If you're
        using the Muryu Firefox add-on, select "Share with a group" or "Share
        with the world" from the pop-up menu.
      </p>
      <h4>Tutorial</h4>
      <p>
        The crow might help you get started, why not try clicking him?
      </p>
      <h4>Conclusion</h4>
      <p>
        Have a nice day! Happiness is mandatory!
      </p>
    </div>
  </body>
</html>
